import sys
import time
import RPi.GPIO as GPIO
import telepot
from telepot.loop import MessageLoop

# Replace 'YOUR_BOT_TOKEN_HERE' with token from BotFather
TOKEN = 'YOUR_BOT_TOKEN_HERE'

GPIO.setmode(GPIO.BOARD)
GPIO.setwarnings(False)
GPIO.setup(40, GPIO.OUT)
GPIO.output(40, GPIO.LOW)  # Start off

def handle(msg):
    chat_id = msg['chat']['id']
    command = msg['text']
    print('Got command:', command)
    
    if command == '/on':
        bot.sendMessage(chat_id, "LED on")
        GPIO.output(40, GPIO.HIGH)
    elif command == '/off':
        bot.sendMessage(chat_id, "LED off")
        GPIO.output(40, GPIO.LOW)
    elif command == '/stop':
        bot.sendMessage(chat_id, "Stopping bot...")
        GPIO.cleanup()
        sys.exit(0)

bot = telepot.Bot(TOKEN)
MessageLoop(bot, handle).run_as_thread()
print('Listening for Telegram commands...')

while True:
    time.sleep(10)
